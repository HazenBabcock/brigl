<!doctype html>
<html lang="en">
<head>
        <title>Beta step example</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
                body { background-color: #ccccff;       margin: 0px; font-family: Monospace; font-weight: bold; }
                #container  { background-color: #ffffff; border:1px solid black; width:800px; height:600px; position:relative; top:0px; left:0px; }
        </style>
</head>

<script src="js/three.min.js"></script>
<script src="js/prototype.js"></script>
<script src="js/Detector.js"></script>
<script src="js/brigl_materials.js"></script>
<script src="js/brigl.js"></script>
<script src="js/tween.min.js"></script>
<script>
var step = 0;
var totStep = 0;
var builder;
var cont;
var offset;
var obj3d;

function updateStepDisplay()
{
	document.getElementById("x").textContent = step+"/"+totStep;
}

function init() 
{
  if ( ! Detector.webgl ) { alert("no webgl"); return; }
  
  // capture and show log
        BRIGL.log = function(msg){document.getElementById("logarea").innerText = msg;};
        
        // create the builder object to obtain the models
        builder = new BRIGL.Builder("parts/");
        
        // load a model..
        builder.loadModelByName("modelHoverpod2.mpd", {dontCenter:true, drawLines:true}, function(mesh)
        {
        	obj3d = mesh;
          cont = new BRIGL.BriglContainer(document.getElementById("container"), mesh);     
          cont.render();
        });
}

function animate() {

	if(	TWEEN.update() ) requestAnimationFrame( animate )

}

function clicked()
{
	var position = { v: 0.0 };
	var target = { v: Math.PI/2 };
	
	var qStart = new THREE.Quaternion();
	qStart.copy(obj3d.brigl.animatedMesh.top.quaternion);
	
	var tween = new TWEEN.Tween(position).to(target, 500);
	tween.onUpdate( function () {
			var qMult = new THREE.Quaternion();
			qMult.setFromAxisAngle(new THREE.Vector3(1,0,0), position.v);
			obj3d.brigl.animatedMesh.top.quaternion.multiply(qStart, qMult);
			
			obj3d.brigl.animatedMesh.top.updateMatrix();	
			cont.render();

	} ); 
	tween.easing(TWEEN.Easing.Elastic.Out);
	tween.start();
	animate();
}

</script>
<body onload="init();">
        <p id="logarea">Initializing...</p>
        <div id="container">
        </div>
<input type="button" onclick="clicked();" value="anim" />
</body>
</html>